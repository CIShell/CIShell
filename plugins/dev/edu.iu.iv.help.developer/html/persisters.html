<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">	<head>		<title>Persister Plug-in Tutorial - IVC Developer Guide</title>		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" 			/>		<link href="ivcdocstyle.css" rel="stylesheet" type="text/css" />	</head>	<body>		<p class="backtotoc">			<a href="main.html#TOC" class="backtotoc">[Back To TOC]</a>		</p>		<p>			<span class="section_heading">Persister Plug-in Tutorial</span>			<br />			<span class="metainfo">Author: <a href="mailto:jasellis@NOSPAM.cs.indiana.edu">James Ellis</a><br /> Last Modified: 				April 21, 2005 </span>		</p>		<p class="subsection_heading">Summary</p>		<p class="body_text">			A plug-in that contributes to the IVC Persistence scheme gives			users the ability to save and restore DataModels to different			file formats.  Persister plug-ins use a custom template in the			Eclipse PDE, and interface with the core persistence plug-in to 			add new Persister implementations.		</p>		<p class="subsection_heading">Pre-requisites</p>		<p class="body_text"> Before you read this document, it is useful to 			have some working knowlege of <a 			href="http://www.eclipse.org">Eclipse</a> and the Eclipse plug-in 			framework. We will be discussing the creation of a standard Eclipse 			plug-in and using the PDE Wizard and Template functionality, but no 			prior knowledge of these topics is assumed. It is assumed that the 			<a href="plugindev.html">IVC Plug-in Development feature</a> has 			been installed.</p>		<p class="section_heading">			<span class="subsection_heading">Section Table of Contents</span>			<a name="section_toc" id="section_toc"></a>		</p>		<ol>			<li class="body_text">				<a href="#persister">Creating a Persister Plug-in</a>							</li>			<li class="body_text">				<a href="#implementation">Example Persister Implementation</a>							</li>						<li class="body_text">				<a href="#further_reading">Further Reading</a>			</li>		</ol>												<hr align="center" width="50%" />		<a name="persister" id="persister"/>		<p class="backtotoc">			<a href="#section_toc">[Back to Section TOC]</a>		</p>				<p class="subsection_heading">Creating a Persister Plug-in</p>		<p class="body_text">			Creating a Persister plug-in allows users to load and save			DataModels in IVC using different file formats.  Often times a plug-in			will have some specific format that it is used to, therefore a new			Persister needs to be introduced that can handle the format.			This process consists of creating a Persister plug-in project and			autogenerating the code the registers your Persister(s) with IVC, and			implementing one or more implementations of the Persister interface			to handle the job of saving and restoring from the desired format.		</p>		<p class="body_text">			First we will create the new Persister plug-in project in Eclipse.			Go to <strong>File->New->Project...</strong> and choose <code>			Plug-in Project</code> in the <em>Plug-in Development</em> section.			This will launch the general Eclipse PDE wizard.  Enter in a name for the			project and ensure that <em>Create a Java project</em> is selected in			the <strong>Project contents</strong> section.		</p>		<div align="center">			<img src="images/persister/1.png" alt="first dialog of the PDE wizard" class="figure" />			<div class="figurecaption">				<p>Fig1: The first page of the wizard should look something like this,					with a name added and the checkbox for creating a Java project					selected.</p>			</div>		</div>			<p class="body_text">			Press <strong>Next ></strong> to continue on to the <strong>Plug-in			Content</strong> page of the wizard. Enter in the desired information for			ID, version, name, provider, and jar filename.  Be sure to <strong>uncheck</strong>			the checkbox that says <em>Generate the Java class that controls the			plug-in's life cycle (recommended)</em> in the <strong>Plug-in Class</strong>			section.  We do not need this autogenerated class since the IVC templates			create everything we need already.		</p>		<div align="center">			<img src="images/persister/2.png" alt="plug-in content page" class="figure" />			<div class="figurecaption">				<p>Fig2: The Plug-in Content page should look like this figure, with					the information at the top filled out, and the checkbox for					generating the Java class to control the plug-ins life cycle					<strong>unchecked</strong>.</p>			</div>		</div>				<p class="body_text">			Press <strong>Next ></strong> to continue to the next page where we can			now select the IVC template we wish to use. Check the box that says			<em>Create a plug-in using one of the templates</em>, and select the			IVC Persister template.		</p>		<p class="tip"> <strong>Trouble?</strong> 			If you do not see <strong>IVC Persister</strong> as a choice in the			template selection, you need to revisit the document on			<a href="plugindev.html">Beginning Plug-in Development in IVC</a>.		</p>		<div align="center">			<img src="images/persister/3.png" alt="selecting a template" class="figure" />			<div class="figurecaption">				<p>Fig3: The IVC Persister template is selected.</p>			</div>		</div>				<p class="body_text">			Press <strong>Next ></strong> to continue to the final page of the			wizard, where the IVC specific template options are available.  Enter			in the package name you wish for the autogenrated code to be placed,			as well as the class name you prefer for the autogenerated class that			handles the job of registering your Persister implementations with			the IVC PersistenceRegistry.		</p>		<div align="center">			<img src="images/persister/4.png" alt="setting the code generation preferences" class="figure" />			<div class="figurecaption">				<p>Fig4: This wizard page allows you to specify preferences about					the code generated by the template.</p>			</div>		</div>		<p class="body_text">			Press <strong>Finish</strong> and the plug-in project will be generated in			Eclipse, with one file already being included in the Java source folder,			being the class that handles the registration of Persisters with IVC when			the plug-in is launched.		</p>		<p class="tip"> <strong>Trouble?</strong> 			If there are any compilation errors with the autogenerated code it is			typically due to the fact that all of the plug-ins that your new			plug-in is dependent on are somehow not where Eclipse expects them to be.			If this happens, you need to revisit the document about			<a href="plugindev.html">Beginning Plug-in Development in IVC</a> and			make sure that the IVC Plug-in Development feature has been installed.		</p>				<p class="body_text">			Once the code generation has completed, the only thing left to do is			actually implement the Persister interface for your new format.			Create a new Java class in whatever package you wish by right clicking			on the package and selecting <strong>New->Class</strong>. Give it a name			and make sure that in the <strong>Interfaces</strong> section you specify			that your new class will implement <code>edu.iu.iv.core.persistence.Persister</code>.			Press <strong>Finish</strong> to create the class.  You will now have to			implement the methods defined in that interface for persisting and restoring,			as well as fill a <code>PropertyMap</code> with various information about			your <code>Persister</code> implemenation, as defined in <code>PersisterProperty</code>.			An example implemenation follows in the next section.		</p>		<div align="center">			<a href="images/persister/5.png">				<img src="images/persister/5.png" alt="the persister project" class="figure" />			</a>			<div class="figurecaption">				<p>Fig5: After the project has been generated and a Persister implementation					has been added, your project should look something like this figure,					with the file structure on the left, and the <code>plugin.xml</code> 					file shown on the right.</p>			</div>		</div>				<p class="body_text">			After one or more Persisters have been implemented the Persister plug-in			is functional.  Exporting it and plugging it into the IVC system will			result in new choices when reading and writing DataModels and allow you			to use new formats for new plug-ins.		</p>		<hr align="center" width="50%" />		<a name="implemenation" id="implemenation"/>		<p class="backtotoc">			<a href="#section_toc">[Back to Section TOC]</a>		</p>						<p class="subsection_heading">Example Persister Implemenation</p>		<p class="body_text">			Below is an example implemenation of the Persister interface to give you			and idea of how things work.  This Persister is very simple, with its 			format being simple plain text files, and the model it restores being			a String Object.  The Persister just writes out the String to a text file			to store, and reads it back in to restore it.  This simple example shows			the concept of saving and loading a DataModel though that can be generalized			to any format, as well as the typical file structure and PersisterProperties			that should be defined.		</p>		<pre>--------------------------------------------------------------------package edu.iu.iv.persisters.persisterx;import java.io.BufferedReader;import java.io.BufferedWriter;import java.io.FileReader;import java.io.FileWriter;import java.io.IOException;import edu.iu.iv.core.datamodels.DataModelType;import edu.iu.iv.core.persistence.FileResourceDescriptor;import edu.iu.iv.core.persistence.PersistenceException;import edu.iu.iv.core.persistence.Persister;import edu.iu.iv.core.persistence.PersisterProperty;import edu.iu.iv.core.persistence.ResourceDescriptor;import edu.iu.iv.core.property.PropertyMap;public class PersisterX implements Persister {	private PropertyMap propertyMap;		public PersisterX(){		propertyMap = new PropertyMap() ;		propertyMap.put(PersisterProperty.PERSISTER_NAME, "Sample Persister") ;		propertyMap.put(PersisterProperty.RESTORABLE_MODEL_NAME, "String") ;		propertyMap.put(PersisterProperty.RESTORABLE_MODEL_DESCRIPTION, 		                "This Persister just restores a String model") ;		propertyMap.put(PersisterProperty.SUPPORTED_FILE_EXTENSION, ".string") ;		propertyMap.put(PersisterProperty.FORMAT_NAME, "String text format") ;		propertyMap.put(PersisterProperty.FORMAT_DESCRIPTION, 		                "This format contains the String in a text file") ;		propertyMap.put(PersisterProperty.RESTORABLE_MODEL_TYPE, 		                new DataModelType("String"));		}		public void persist(Object model, ResourceDescriptor destination) 		throws IOException, PersistenceException {					BufferedWriter outFile = null;		try{						FileResourceDescriptor file = (FileResourceDescriptor) destination;			outFile = new BufferedWriter(new FileWriter(file.getFilePath()));			outFile.write(model.toString());			outFile.close();		}		catch (IOException e) {		    if (outFile != null)outFile.close();		    throw e;		}							}	public Object restore(ResourceDescriptor dataSource) 		throws IOException,OutOfMemoryError, PersistenceException {				BufferedReader inFile = null;		String model = "";		try{			FileResourceDescriptor file = (FileResourceDescriptor) dataSource;			inFile = new BufferedReader(new FileReader(file.getFilePath()));			String line = inFile.readLine();			while(line != null){				model = model + line + "\n";				line = inFile.readLine();			}			inFile.close();		}		catch (IOException e) {			inFile.close();			throw e;		}		catch (OutOfMemoryError e){		    inFile.close();		    throw e;		}		return model;	}	public boolean canPersist(Object model) {		return model instanceof String;	}	public boolean canRestore(ResourceDescriptor source) {		if(!(source instanceof FileResourceDescriptor)) return false;				FileResourceDescriptor descriptor = (FileResourceDescriptor) source;		String acceptedExtension = 		   (String)propertyMap.getPropertyValue(PersisterProperty.SUPPORTED_FILE_EXTENSION);		return acceptedExtension.equals(descriptor.getFileExtension());	}	public PropertyMap getPropertyMap() {		return propertyMap;	}}	--------------------------------------------------------------------</pre>						<hr align="center" width="50%" />		<a name="further_reading" id="further_reading"/>		<p class="backtotoc">			<a href="#section_toc">[Back to Section TOC]</a>		</p>						<p class="subsection_heading">Further Reading</p>		<p class="body_text">			<a href="http://www.eclipse.org/articles/Article-PDE-does-plugins/PDE-intro.html">			PDE Does Plug-ins</a>		</p>			<p class="backtotoc"><a href="#section_toc">[Back to Section TOC]</a> | 			<a href="main.html#TOC">[Back To TOC]</a></p>	</body></html>